name: Build Guard

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  validate-docker:
    name: Validate Docker Setup
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Check docker-compose.yml
      run: |
        echo "ğŸ” PrÃ¼fe docker-compose.yml auf Syntaxfehler..."
        docker compose config -q || (echo "âŒ docker-compose.yml ungÃ¼ltig!" && exit 1)

    - name: Check .dockerignore
      run: |
        echo "ğŸ” PrÃ¼fe .dockerignore ..."
        if [ ! -f .dockerignore ]; then
          echo "âŒ .dockerignore fehlt â€“ bitte hinzufÃ¼gen!"
          exit 1
        else
          echo "âœ… .dockerignore vorhanden"
        fi

    - name: Liste der zu bauenden Services
      run: |
        echo "ğŸ” Docker-Build-Konfiguration prÃ¼fen..."
        docker compose config | grep 'build:' || echo "âš ï¸ Keine Services mit Build-Kontext"

    - name: Baue alle Build-Services (testweise)
      run: |
        echo "ğŸ”§ Testweise Build starten..."
        docker compose build --progress plain --parallel || (echo "âŒ Build fehlgeschlagen!" && exit 1)
